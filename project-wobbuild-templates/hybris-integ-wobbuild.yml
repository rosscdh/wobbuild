language: java
clean: false

repo:
  name: Integ - HYBRIS
  url: ssh://git@git.dglecom.net:7999/hybris/hybris.git


build_group_matcher:
  release: release/(.+)

#
# Release branch steps
# Releases usually involve a publish step
#
release:
  before_steps:
    # checkout the build scripts
    - git clone ssh://git@git.dglecom.net:7999/ops/jenkins-build.git ../


  build:
    do: true
    steps:
    # fetch maven dependencies
    - ./maven/fetchDependenciesWithBundledMaven.sh
    # do the ant loading and clean
    - 'cd ../;[ -f "~/.bashrc" ] && source ~/.bashrc;[ -f "~/.bash_profile" ] && source ~/.bash_profile;. ./setantenv.sh;ant clean all'

  publish:
    do: true
    steps:
      #- echo "Compile to RPM"
      - 'cd ../;docker -e VERSION={{ VERSION }} -e RELEASE={{ BUILD_ID }} https://artifactory.dglecom.net:6555/bamboo-cartmanagement-rpm-creator:latest'
      - echo "Upload to artifactory"

  deploy:
    do: true
    steps:
      - echo "Deploy this thing to a remote integ server"

  final_steps:
    - echo "Message to slack"
